(()=>{var e={};e.id=6477,e.ids=[6477],e.modules={34590:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=34590,e.exports=t},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},35816:e=>{"use strict";e.exports=require("process")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},95346:e=>{"use strict";e.exports=require("timers")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},18487:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>p,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{POST:()=>c});var s=r(71707),o=r(93006),n=r(68467),i=r(34033),u=r(39787);async function c(e){try{let t;let r=await e.json(),a=await (0,u.VH)(),s=["customer_name","payment_method","payment_amount","cashier_id","items"].filter(e=>{let t=r[e]??r[({customer_name:"customerName",payment_method:"paymentMethod",payment_amount:"amountPaid",cashier_id:"cashierId",items:"items"})[e]];return"items"===e?!Array.isArray(t)||0===t.length:"payment_amount"===e?void 0===t||Number.isNaN(Number(t)):null==t||""===t});if(s.length>0)return i.NextResponse.json({success:!1,error:`Missing or invalid required fields: ${s.join(", ")}`},{status:400});let{transactionService:o}=await (0,u.U2)();if("mysql"===a){let e={customer_name:r.customer_name??r.customerName,payment_method:r.payment_method??r.paymentMethod,payment_amount:r.payment_amount??r.amountPaid,cashier_id:r.cashier_id??r.cashierId,total_amount:r.total_amount??r.totalAmount,tax_amount:r.tax_amount??r.taxAmount,discount_amount:r.discount_amount??r.discountAmount,change_amount:r.change_amount??r.changeAmount,items:(r.items||[]).map(e=>({product_id:e.product_id??e.productId,quantity:e.quantity,unit_price:e.unit_price??e.price,total_price:e.total_price??e.subtotal,discount:e.discount}))};t=await o.createTransaction(e)}else{let e={customerName:r.customer_name??r.customerName,paymentMethod:r.payment_method??r.paymentMethod,amountPaid:r.payment_amount??r.amountPaid,cashierId:r.cashier_id??r.cashierId,items:(r.items||[]).map(e=>({productId:e.product_id??e.productId,quantity:e.quantity,price:e.unit_price??e.price,subtotal:e.total_price??e.subtotal}))};t=await o.createTransaction(e)}return i.NextResponse.json({success:!0,transaction:t})}catch(e){return console.error("[v0] Transaction API error:",e),i.NextResponse.json({success:!1,error:"Transaction failed",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/transactions/create/route",pathname:"/api/transactions/create",filename:"route",bundlePath:"app/api/transactions/create/route"},resolvedPagePath:"/workspace/app/api/transactions/create/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:p}=d,h="/api/transactions/create/route";function y(){return(0,n.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:m})}},51753:(e,t,r)=>{"use strict";r.d(t,{M7:()=>u,executeQuery:()=>i});var a=r(16604);let s={host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"famq4413_william",password:process.env.DB_PASSWORD||"15juli2001",database:process.env.DB_NAME||"famq4413_family_store",port:Number.parseInt(process.env.DB_PORT||"3306"),ssl:!!(process.env.DB_HOST?.includes("planetscale")||process.env.DB_HOST?.includes("railway"))&&{rejectUnauthorized:!1},connectTimeout:6e4,acquireTimeout:6e4,timeout:6e4,connectionLimit:10,queueLimit:0,charset:"utf8mb4",timezone:"+07:00"},o=null;async function n(){if(!o)try{o=a.createPool(s);let e=await o.getConnection();await e.ping(),e.release(),console.log(`[POS] MySQL connected successfully to ${s.host}:${s.port}/${s.database}`)}catch(e){if(console.error("[POS] MySQL connection failed:",e),e instanceof Error){let t=e.message||String(e);if(t.includes("ECONNREFUSED"))throw Error(`Tidak dapat terhubung ke MySQL di ${s.host}:${s.port}. Pastikan server MySQL berjalan dan dapat diakses. Periksa DB_HOST/DB_PORT atau jalankan database terlebih dahulu.`);if(t.includes("ETIMEDOUT"))throw Error(`Koneksi ke MySQL timeout ke ${s.host}:${s.port}. Periksa firewall, jaringan, atau gunakan host yang benar (mis. host Docker atau cloud).`);if(t.includes("EAI_AGAIN")||t.includes("ENOTFOUND"))throw Error(`Database host tidak ditemukan atau DNS bermasalah: ${s.host}. Periksa nilai DB_HOST.`);if(t.includes("Access denied"))throw Error("Akses ditolak. Periksa username dan password database.");if(t.includes("Unknown database"))throw Error(`Database '${s.database}' tidak ditemukan. Pastikan database sudah dibuat.`)}throw e}return o}async function i(e,t=[]){let r=await n(),a=null;try{a=await r.getConnection();let[s]=await a.execute(e,t);return s}catch(r){if(console.error("[POS] Query execution failed:",r),console.error("[POS] Query:",e),console.error("[POS] Params:",t),r instanceof Error){if(r.message.includes("Table")&&r.message.includes("doesn't exist"))throw Error("Tabel tidak ditemukan. Jalankan migration terlebih dahulu: /api/migrate");if(r.message.includes("Duplicate entry"))throw Error("Data sudah ada. Tidak dapat menambahkan data yang sama.");if(r.message.includes("cannot be null"))throw Error("Field wajib tidak boleh kosong.")}throw r}finally{a&&a.release()}}async function u(){try{let e=await n(),t=await e.getConnection();return await t.ping(),t.release(),{success:!0,message:`Koneksi berhasil ke ${s.host}:${s.port}/${s.database}`,config:{host:s.host,port:s.port,database:s.database,user:s.user,ssl:!!s.ssl}}}catch(e){return{success:!1,message:e instanceof Error?e.message:"Unknown error",config:{host:s.host,port:s.port,database:s.database,user:s.user,ssl:!!s.ssl}}}}},39787:(e,t,r)=>{"use strict";r.d(t,{U2:()=>i,VH:()=>u});var a=r(51753);let s=null;async function o(e,t){return await Promise.race([e,new Promise((e,r)=>setTimeout(()=>r(Error("timeout")),t))])}async function n(){if(s)return s;try{let e=await o((0,a.M7)(),3e3);if(e&&e.success)return s="mysql"}catch(e){}return process.env.SUPABASE_URL,process.env.SUPABASE_ANON_KEY,s="supabase"}async function i(){if("mysql"===await n())return await r.e(808).then(r.bind(r,20808));let e=await Promise.all([r.e(1695),r.e(1522)]).then(r.bind(r,11522)),t={...e.productService,async adjustStock(t,a,s){let o=await e.productService.getProductById(t);if(!o)throw Error("Product not found");let n=o.stock+a;await e.productService.updateStock(t,n);try{let{supabase:e}=await Promise.all([r.e(1695),r.e(3330)]).then(r.bind(r,23330));await e.from("stock_history").insert([{product_id:t,quantity_change:a,reason:s}])}catch(e){}},async getStockHistory(){try{let{supabase:e}=await Promise.all([r.e(1695),r.e(3330)]).then(r.bind(r,23330)),{data:t,error:a}=await e.from("stock_history").select("*, products(name)").order("created_at",{ascending:!1});if(a)throw a;return(t||[]).map(e=>({...e,productName:e.products?.name||"Unknown"}))}catch(e){return[]}}};return{...e,productService:t}}async function u(){return await n()}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[6325,1276,6604],()=>r(18487));module.exports=a})();