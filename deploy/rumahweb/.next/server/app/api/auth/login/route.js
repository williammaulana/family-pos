(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={34590:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=34590,e.exports=r},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},98216:e=>{"use strict";e.exports=require("net")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},95346:e=>{"use strict";e.exports=require("timers")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},23298:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>E,patchFetch:()=>f,requestAsyncStorage:()=>h,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var a={};t.r(a),t.d(a,{POST:()=>d});var s=t(71707),o=t(93006),i=t(68467),n=t(34033),u=t(20808),l=t(64516),c=t.n(l);async function d(e){try{let{email:r,password:a}=await e.json();if(!r||!a)return n.NextResponse.json({error:"Email and password are required"},{status:400});await (0,u.initializeDatabase)();let{executeQuery:s}=await Promise.resolve().then(t.bind(t,51753)),o=await s("SELECT COUNT(*) as cnt FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = 'users' AND COLUMN_NAME = 'password_hash'"),i=Array.isArray(o)&&o.length>0&&(o[0].cnt??0)>0,l=await s(i?"SELECT id, email, name, role, password_hash FROM users WHERE email = ?":"SELECT id, email, name, role FROM users WHERE email = ?",[r]);if(!l||0===l.length)return n.NextResponse.json({error:"Invalid credentials"},{status:401});let d=l[0],p=d.password_hash||"$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi";if(!await c().compare(a,p))return n.NextResponse.json({error:"Invalid credentials"},{status:401});return n.NextResponse.json({user:{id:d.id,name:d.name,email:d.email,role:d.role}})}catch(a){console.error("Login error:",a);let e=a instanceof Error?a.message:"Internal server error",r=e.toLowerCase(),t=r.includes("econnrefused")||r.includes("tidak dapat terhubung ke mysql")||r.includes("timeout");return n.NextResponse.json({error:e},{status:t?503:500})}}let p=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/workspace/app/api/auth/login/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:m,serverHooks:g}=p,E="/api/auth/login/route";function f(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},51753:(e,r,t)=>{"use strict";t.d(r,{M7:()=>u,executeQuery:()=>n});var a=t(16604);let s={host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"famq4413_william",password:process.env.DB_PASSWORD||"15juli2001",database:process.env.DB_NAME||"famq4413_family_store",port:Number.parseInt(process.env.DB_PORT||"3306"),ssl:!!(process.env.DB_HOST?.includes("planetscale")||process.env.DB_HOST?.includes("railway"))&&{rejectUnauthorized:!1},connectTimeout:6e4,acquireTimeout:6e4,timeout:6e4,connectionLimit:10,queueLimit:0,charset:"utf8mb4",timezone:"+07:00"},o=null;async function i(){if(!o)try{o=a.createPool(s);let e=await o.getConnection();await e.ping(),e.release(),console.log(`[POS] MySQL connected successfully to ${s.host}:${s.port}/${s.database}`)}catch(e){if(console.error("[POS] MySQL connection failed:",e),e instanceof Error){let r=e.message||String(e);if(r.includes("ECONNREFUSED"))throw Error(`Tidak dapat terhubung ke MySQL di ${s.host}:${s.port}. Pastikan server MySQL berjalan dan dapat diakses. Periksa DB_HOST/DB_PORT atau jalankan database terlebih dahulu.`);if(r.includes("ETIMEDOUT"))throw Error(`Koneksi ke MySQL timeout ke ${s.host}:${s.port}. Periksa firewall, jaringan, atau gunakan host yang benar (mis. host Docker atau cloud).`);if(r.includes("EAI_AGAIN")||r.includes("ENOTFOUND"))throw Error(`Database host tidak ditemukan atau DNS bermasalah: ${s.host}. Periksa nilai DB_HOST.`);if(r.includes("Access denied"))throw Error("Akses ditolak. Periksa username dan password database.");if(r.includes("Unknown database"))throw Error(`Database '${s.database}' tidak ditemukan. Pastikan database sudah dibuat.`)}throw e}return o}async function n(e,r=[]){let t=await i(),a=null;try{a=await t.getConnection();let[s]=await a.execute(e,r);return s}catch(t){if(console.error("[POS] Query execution failed:",t),console.error("[POS] Query:",e),console.error("[POS] Params:",r),t instanceof Error){if(t.message.includes("Table")&&t.message.includes("doesn't exist"))throw Error("Tabel tidak ditemukan. Jalankan migration terlebih dahulu: /api/migrate");if(t.message.includes("Duplicate entry"))throw Error("Data sudah ada. Tidak dapat menambahkan data yang sama.");if(t.message.includes("cannot be null"))throw Error("Field wajib tidak boleh kosong.")}throw t}finally{a&&a.release()}}async function u(){try{let e=await i(),r=await e.getConnection();return await r.ping(),r.release(),{success:!0,message:`Koneksi berhasil ke ${s.host}:${s.port}/${s.database}`,config:{host:s.host,port:s.port,database:s.database,user:s.user,ssl:!!s.ssl}}}catch(e){return{success:!1,message:e instanceof Error?e.message:"Unknown error",config:{host:s.host,port:s.port,database:s.database,user:s.user,ssl:!!s.ssl}}}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[6325,1276,6604,4516,808],()=>t(23298));module.exports=a})();