(()=>{var e={};e.id=3155,e.ids=[3155],e.modules={34590:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=34590,e.exports=r},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},35816:e=>{"use strict";e.exports=require("process")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},95346:e=>{"use strict";e.exports=require("timers")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},67826:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var s={};t.r(s),t.d(s,{GET:()=>u});var a=t(71707),o=t(93006),i=t(68467),n=t(34033),c=t(39787);async function u(e){try{let{reportsService:e}=await (0,c.U2)(),r=await e.getProductPerformance();return n.NextResponse.json({success:!0,data:r})}catch(e){return console.error("Error fetching product performance:",e),n.NextResponse.json({success:!1,error:"Failed to fetch product performance"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/reports/product-performance/route",pathname:"/api/reports/product-performance",filename:"route",bundlePath:"app/api/reports/product-performance/route"},resolvedPagePath:"/workspace/app/api/reports/product-performance/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:m}=d,h="/api/reports/product-performance/route";function f(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}},51753:(e,r,t)=>{"use strict";t.d(r,{M7:()=>c,executeQuery:()=>n});var s=t(16604);let a={host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"famq4413_william",password:process.env.DB_PASSWORD||"15juli2001",database:process.env.DB_NAME||"famq4413_family_store",port:Number.parseInt(process.env.DB_PORT||"3306"),ssl:!!(process.env.DB_HOST?.includes("planetscale")||process.env.DB_HOST?.includes("railway"))&&{rejectUnauthorized:!1},connectTimeout:6e4,acquireTimeout:6e4,timeout:6e4,connectionLimit:10,queueLimit:0,charset:"utf8mb4",timezone:"+07:00"},o=null;async function i(){if(!o)try{o=s.createPool(a);let e=await o.getConnection();await e.ping(),e.release(),console.log(`[POS] MySQL connected successfully to ${a.host}:${a.port}/${a.database}`)}catch(e){if(console.error("[POS] MySQL connection failed:",e),e instanceof Error){let r=e.message||String(e);if(r.includes("ECONNREFUSED"))throw Error(`Tidak dapat terhubung ke MySQL di ${a.host}:${a.port}. Pastikan server MySQL berjalan dan dapat diakses. Periksa DB_HOST/DB_PORT atau jalankan database terlebih dahulu.`);if(r.includes("ETIMEDOUT"))throw Error(`Koneksi ke MySQL timeout ke ${a.host}:${a.port}. Periksa firewall, jaringan, atau gunakan host yang benar (mis. host Docker atau cloud).`);if(r.includes("EAI_AGAIN")||r.includes("ENOTFOUND"))throw Error(`Database host tidak ditemukan atau DNS bermasalah: ${a.host}. Periksa nilai DB_HOST.`);if(r.includes("Access denied"))throw Error("Akses ditolak. Periksa username dan password database.");if(r.includes("Unknown database"))throw Error(`Database '${a.database}' tidak ditemukan. Pastikan database sudah dibuat.`)}throw e}return o}async function n(e,r=[]){let t=await i(),s=null;try{s=await t.getConnection();let[a]=await s.execute(e,r);return a}catch(t){if(console.error("[POS] Query execution failed:",t),console.error("[POS] Query:",e),console.error("[POS] Params:",r),t instanceof Error){if(t.message.includes("Table")&&t.message.includes("doesn't exist"))throw Error("Tabel tidak ditemukan. Jalankan migration terlebih dahulu: /api/migrate");if(t.message.includes("Duplicate entry"))throw Error("Data sudah ada. Tidak dapat menambahkan data yang sama.");if(t.message.includes("cannot be null"))throw Error("Field wajib tidak boleh kosong.")}throw t}finally{s&&s.release()}}async function c(){try{let e=await i(),r=await e.getConnection();return await r.ping(),r.release(),{success:!0,message:`Koneksi berhasil ke ${a.host}:${a.port}/${a.database}`,config:{host:a.host,port:a.port,database:a.database,user:a.user,ssl:!!a.ssl}}}catch(e){return{success:!1,message:e instanceof Error?e.message:"Unknown error",config:{host:a.host,port:a.port,database:a.database,user:a.user,ssl:!!a.ssl}}}}},39787:(e,r,t)=>{"use strict";t.d(r,{U2:()=>n,VH:()=>c});var s=t(51753);let a=null;async function o(e,r){return await Promise.race([e,new Promise((e,t)=>setTimeout(()=>t(Error("timeout")),r))])}async function i(){if(a)return a;try{let e=await o((0,s.M7)(),3e3);if(e&&e.success)return a="mysql"}catch(e){}return process.env.SUPABASE_URL,process.env.SUPABASE_ANON_KEY,a="supabase"}async function n(){if("mysql"===await i())return await t.e(808).then(t.bind(t,20808));let e=await Promise.all([t.e(1695),t.e(1522)]).then(t.bind(t,11522)),r={...e.productService,async adjustStock(r,s,a){let o=await e.productService.getProductById(r);if(!o)throw Error("Product not found");let i=o.stock+s;await e.productService.updateStock(r,i);try{let{supabase:e}=await Promise.all([t.e(1695),t.e(3330)]).then(t.bind(t,23330));await e.from("stock_history").insert([{product_id:r,quantity_change:s,reason:a}])}catch(e){}},async getStockHistory(){try{let{supabase:e}=await Promise.all([t.e(1695),t.e(3330)]).then(t.bind(t,23330)),{data:r,error:s}=await e.from("stock_history").select("*, products(name)").order("created_at",{ascending:!1});if(s)throw s;return(r||[]).map(e=>({...e,productName:e.products?.name||"Unknown"}))}catch(e){return[]}}};return{...e,productService:r}}async function c(){return await i()}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[6325,1276,6604],()=>t(67826));module.exports=s})();