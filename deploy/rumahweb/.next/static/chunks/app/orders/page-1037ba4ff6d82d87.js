(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[569],{83503:function(e,t,a){Promise.resolve().then(a.bind(a,29917))},29917:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return N}});var s,r=a(76287),n=a(99334),i=a(72993);a(33797);let o="https://your-project-id.supabase.co",l="CHANGE_ME",c=o&&l?(0,i.eI)(o,l):(s="Supabase environment variables are not set. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY (and optionally SUPABASE_URL/SUPABASE_ANON_KEY on the server).",new Proxy({},{get:()=>()=>{throw Error(s)},apply(){throw Error(s)}}));var d=a(25753),m=a(99499),u=a(88448),h=a(15046),p=a(7948),x=a(67539),f=a(10483),v=a(53462),g=a(6124),b=a(73004),y=a(42370),w=a(15184),j=a(28162),S=a(40090);function N(){let{user:e,isLoading:t}=(0,g.a)(),a=(0,w.useRouter)(),{toast:s}=(0,S.pm)(),[i,o]=(0,n.useState)([]),[l,N]=(0,n.useState)(!0),[k,_]=(0,n.useState)(""),[C,T]=(0,n.useState)("all");(0,n.useEffect)(()=>{t||e?e&&A():a.push("/")},[e,t,a]);let A=async()=>{try{console.log("[v0] Fetching transactions...");let{data:e,error:t}=await c.from("transactions").select("id").limit(1);if(t){console.error("[v0] Database tables not found. Please run migration scripts first."),o([]),N(!1);return}let{data:a,error:s}=await c.from("transactions").select("\n          *,\n          transaction_items(\n            quantity,\n            products(name)\n          )\n        ").order("created_at",{ascending:!1});if(s)throw console.error("[v0] Supabase error:",s),s;if(console.log("[v0] Transactions fetched:",(null==a?void 0:a.length)||0),a&&a.length>0){let e=[...new Set(a.map(e=>e.cashier_id).filter(Boolean))],{data:t,error:s}=await c.from("users").select("id, name").in("id",e);s&&console.error("[v0] Users fetch error:",s);let r=a.map(e=>({...e,users:(null==t?void 0:t.find(t=>t.id===e.cashier_id))||null}));o(r)}else o([])}catch(e){console.error("[v0] Error fetching transactions:",e),o([])}finally{N(!1)}},E=e=>{switch(e){case"completed":return(0,r.jsx)(m.C,{className:"bg-green-100 text-green-800",children:"Selesai"});case"cancelled":return(0,r.jsx)(m.C,{className:"bg-red-100 text-red-800",children:"Dibatalkan"});default:return(0,r.jsx)(m.C,{children:e})}},O=e=>{switch(e){case"tunai":return"Tunai";case"kartu_debit":return"Kartu Debit";case"kartu_kredit":return"Kartu Kredit";case"e_wallet":return"E-Wallet";case"qris":return"QRIS";case"transfer_bank":return"Transfer Bank";default:return e}},D=i.filter(e=>{var t,a;let s=e.transaction_code.toLowerCase().includes(k.toLowerCase())||(null===(t=e.customer_name)||void 0===t?void 0:t.toLowerCase().includes(k.toLowerCase()))||(null===(a=e.users)||void 0===a?void 0:a.name.toLowerCase().includes(k.toLowerCase())),r="all"===C||e.status===C;return s&&r});return t?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-2 text-gray-600",children:"Memuat..."})]})}):e?l?(0,r.jsx)(y.c,{children:(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),(0,r.jsx)("div",{className:"h-64 bg-gray-200 rounded"})]})})}):(0,r.jsx)(y.c,{children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"History Orders"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Pantau semua transaksi penjualan"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(h.z,{variant:"outline",onClick:()=>{let e={headers:["Kode Transaksi","Nama Pelanggan","Kasir","Total","Pajak","Metode Pembayaran","Status","Tanggal"],rows:D.map(e=>{var t;return[e.transaction_code,e.customer_name||"Walk-in Customer",(null===(t=e.users)||void 0===t?void 0:t.name)||"Unknown",e.total_amount+e.tax_amount,e.tax_amount,O(e.payment_method),"completed"===e.status?"Selesai":"Dibatalkan",(0,b.p6)(e.created_at)]}),filename:"history-orders-".concat(new Date().toISOString().split("T")[0])};(0,j.GS)(e),s({title:"Export Berhasil",description:"Data history orders berhasil diekspor ke CSV"})},size:"sm",children:[(0,r.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),(0,r.jsxs)(h.z,{variant:"outline",onClick:()=>{let e=D.map(e=>{var t;return{transaction_code:e.transaction_code,customer_name:e.customer_name||"Walk-in Customer",cashier:(null===(t=e.users)||void 0===t?void 0:t.name)||"Unknown",total_amount:e.total_amount+e.tax_amount,tax_amount:e.tax_amount,payment_method:O(e.payment_method),status:"completed"===e.status?"Selesai":"Dibatalkan",created_at:e.created_at,items:e.transaction_items.map(e=>({product_name:e.products.name,quantity:e.quantity}))}});(0,j.cs)(e,"history-orders-".concat(new Date().toISOString().split("T")[0])),s({title:"Export Berhasil",description:"Data history orders berhasil diekspor ke JSON"})},size:"sm",children:[(0,r.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"Export JSON"]})]})]}),(0,r.jsx)(d.Zb,{children:(0,r.jsx)(d.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsx)(f.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,r.jsx)(u.I,{placeholder:"Cari berdasarkan kode transaksi, nama pelanggan, atau kasir...",value:k,onChange:e=>_(e.target.value),className:"pl-10"})]}),(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,r.jsx)(h.z,{variant:"all"===C?"default":"outline",onClick:()=>T("all"),size:"sm",children:"Semua"}),(0,r.jsx)(h.z,{variant:"completed"===C?"default":"outline",onClick:()=>T("completed"),size:"sm",children:"Selesai"}),(0,r.jsx)(h.z,{variant:"cancelled"===C?"default":"outline",onClick:()=>T("cancelled"),size:"sm",children:"Dibatalkan"})]})]})})}),(0,r.jsx)("div",{className:"grid gap-4",children:D.map(e=>{var t;return(0,r.jsx)(d.Zb,{className:"hover:shadow-md transition-shadow",children:(0,r.jsxs)(d.aY,{className:"p-4 md:p-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start mb-4 gap-4",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[(0,r.jsx)("h3",{className:"font-semibold text-base md:text-lg",children:e.transaction_code}),E(e.status)]}),(0,r.jsx)("p",{className:"text-gray-600 text-sm md:text-base",children:e.customer_name||"Walk-in Customer"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:["Kasir: ",(null===(t=e.users)||void 0===t?void 0:t.name)||"Unknown"]})]}),(0,r.jsxs)("div",{className:"text-left sm:text-right",children:[(0,r.jsx)("p",{className:"text-xl md:text-2xl font-bold text-blue-600",children:(0,b.xG)(e.total_amount+e.tax_amount)}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:(0,b.p6)(e.created_at)})]})]}),(0,r.jsxs)("div",{className:"border-t pt-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Subtotal"}),(0,r.jsx)("p",{className:"font-medium",children:(0,b.xG)(e.total_amount)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Pajak"}),(0,r.jsx)("p",{className:"font-medium",children:(0,b.xG)(e.tax_amount)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Metode Pembayaran"}),(0,r.jsx)("p",{className:"font-medium",children:O(e.payment_method)})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-sm text-gray-500 mb-2",children:["Item (",e.transaction_items.reduce((e,t)=>e+t.quantity,0)," produk)"]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[e.transaction_items.slice(0,3).map((e,t)=>(0,r.jsxs)(m.C,{variant:"outline",className:"text-xs",children:[e.quantity,"x ",e.products.name]},t)),e.transaction_items.length>3&&(0,r.jsxs)(m.C,{variant:"outline",className:"text-xs",children:["+",e.transaction_items.length-3," lainnya"]})]})]})]})]})},e.id)})}),0===D.length&&(0,r.jsx)(d.Zb,{children:(0,r.jsxs)(d.aY,{className:"p-12 text-center",children:[(0,r.jsx)("div",{className:"text-gray-400 mb-4",children:(0,r.jsx)(v.Z,{className:"h-12 w-12 mx-auto"})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Tidak ada transaksi ditemukan"}),(0,r.jsx)("p",{className:"text-gray-600",children:k||"all"!==C?"Coba ubah filter pencarian Anda":"Belum ada transaksi yang tercatat. Pastikan tabel database sudah dibuat dengan menjalankan script migrasi."})]})})]})}):null}},99499:function(e,t,a){"use strict";a.d(t,{C:function(){return l}});var s=a(76287);a(99334);var r=a(53739),n=a(15437),i=a(73004);let o=(0,n.j)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:a,asChild:n=!1,...l}=e,c=n?r.g7:"span";return(0,s.jsx)(c,{"data-slot":"badge",className:(0,i.cn)(o({variant:a}),t),...l})}},88448:function(e,t,a){"use strict";a.d(t,{I:function(){return n}});var s=a(76287);a(99334);var r=a(73004);function n(e){let{className:t,type:a,...n}=e;return(0,s.jsx)("input",{type:a,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...n})}},40090:function(e,t,a){"use strict";a.d(t,{pm:function(){return u}});var s=a(99334);let r=0,n=new Map,i=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?i(a):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function d(e){c=o(c,e),l.forEach(e=>{e(c)})}function m(e){let{...t}=e,a=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>d({type:"DISMISS_TOAST",toastId:a});return d({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function u(){let[e,t]=s.useState(c);return s.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:m,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},28162:function(e,t,a){"use strict";function s(e){let t=new Blob([[e.headers.join(","),...e.rows.map(e=>e.map(e=>"string"==typeof e&&e.includes(",")?'"'.concat(e.replace(/"/g,'""'),'"'):e).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");if(void 0!==a.download){let s=URL.createObjectURL(t);a.setAttribute("href",s),a.setAttribute("download","".concat(e.filename,".csv")),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}function r(e,t){let a=new Blob([JSON.stringify(e,null,2)],{type:"application/json;charset=utf-8;"}),s=document.createElement("a");if(void 0!==s.download){let e=URL.createObjectURL(a);s.setAttribute("href",e),s.setAttribute("download","".concat(t,".json")),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}function n(e){let t=e.split("\n"),a=[];for(let e of t)if(e.trim()){let t=[],s="",r=!1;for(let a=0;a<e.length;a++){let n=e[a];'"'===n?r=!r:","!==n||r?s+=n:(t.push(s.trim()),s="")}t.push(s.trim()),a.push(t)}return a}function i(e){let t={SheetNames:["Sheet1"],Sheets:{Sheet1:{}}},a={};e.headers.forEach((e,t)=>{a[String.fromCharCode(65+t)+"1"]={v:e,t:"s"}}),e.rows.forEach((e,t)=>{e.forEach((e,s)=>{a[String.fromCharCode(65+s)+(t+2)]={v:e,t:"number"==typeof e?"n":"s"}})});let s="A1:".concat(String.fromCharCode(65+e.headers.length-1)).concat(e.rows.length+1);a["!ref"]=s,t.Sheets.Sheet1=a;let r=new Blob([function(e){let t=new ArrayBuffer(e.length),a=new Uint8Array(t);for(let t=0;t<e.length;t++)a[t]=255&e.charCodeAt(t);return t}(function(e){let t;let a=new Map;a.set("[Content_Types].xml",'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">\n<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>\n<Default Extension="xml" ContentType="application/xml"/>\n<Override PartName="/xl/workbook.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml"/>\n<Override PartName="/xl/worksheets/sheet1.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml"/>\n</Types>'),a.set("_rels/.rels",'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">\n<Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="xl/workbook.xml"/>\n</Relationships>'),a.set("xl/_rels/workbook.xml.rels",'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">\n<Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet" Target="worksheets/sheet1.xml"/>\n</Relationships>'),a.set("xl/workbook.xml",'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main">\n<sheets><sheet name="Sheet1" sheetId="1" r:id="rId1" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"/></sheets>\n</workbook>');let s=e.Sheets.Sheet1,r="<sheetData>";if(s["!ref"]){let e=l(s["!ref"]);for(let t=e.s.r;t<=e.e.r;t++){r+='<row r="'.concat(t+1,'">');for(let a=e.s.c;a<=e.e.c;a++){let e=d({r:t,c:a}),n=s[e];if(n){let t="n"===n.t?"":' t="inlineStr"',a="n"===n.t?"<v>".concat(n.v,"</v>"):"<is><t>".concat(String(n.v).replace(/[<>&'"]/g,e=>{switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;";default:return e}}),"</t></is>");r+='<c r="'.concat(e,'"').concat(t,">").concat(a,"</c>")}}r+="</row>"}}return r+="</sheetData>",a.set("xl/worksheets/sheet1.xml",'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main">\n'.concat(r,"\n</worksheet>")),t="",a.forEach((e,a)=>{t+=e}),t}(t))],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=document.createElement("a");if(void 0!==n.download){let t=URL.createObjectURL(r);n.setAttribute("href",t),n.setAttribute("download","".concat(e.filename,".xlsx")),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}function o(e){return new Promise((t,a)=>{let s=new FileReader;s.onload=e=>{try{var s;new Uint8Array(null===(s=e.target)||void 0===s?void 0:s.result);let a={SheetNames:["Sheet1"],Sheets:{Sheet1:{"!ref":"A1:A1",A1:{v:"Sample",t:"s"}}}},r=a.SheetNames[0],n=a.Sheets[r],i=[],o=n["!ref"];if(!o){t([]);return}let c=l(o);for(let e=c.s.r;e<=c.e.r;e++){let t=[];for(let a=c.s.c;a<=c.e.c;a++){let s=n[d({r:e,c:a})];t.push(s?String(s.v):"")}i.push(t)}t(i)}catch(e){a(e)}},s.onerror=()=>a(Error("Failed to read file")),s.readAsArrayBuffer(e)})}function l(e){let t=e.split(":"),a=c(t[0]),s=t[1]?c(t[1]):a;return{s:a,e:s}}function c(e){let t=e.match(/([A-Z]+)(\d+)/);if(!t)return{r:0,c:0};let a=t[1].split("").reduce((e,t)=>26*e+t.charCodeAt(0)-64,0)-1;return{r:Number.parseInt(t[2])-1,c:a}}function d(e){let t="",a=e.c;for(;a>=0;)t=String.fromCharCode(65+a%26)+t,a=Math.floor(a/26)-1;return t+(e.r+1)}a.d(t,{GS:function(){return s},bW:function(){return n},cs:function(){return r},gY:function(){return o},pq:function(){return i}})}},function(e){e.O(0,[734,64,344,821,592,68,975,731,744],function(){return e(e.s=83503)}),_N_E=e.O()}]);